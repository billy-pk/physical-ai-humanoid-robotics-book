"use strict";(globalThis.webpackChunkfrontend=globalThis.webpackChunkfrontend||[]).push([[263],{2779:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"module-1/chapter-1-2","title":"1.2 Python Integration with rclpy","description":"Python is the primary language for rapid robotics development. The \\\\rclpy\\\\ library provides a Pythonic interface to ROS 2, enabling you to build nodes, publish data, subscribe to topics, and create services\u2014all with clean, readable code.","source":"@site/docs/module-1/chapter-1-2.md","sourceDirName":"module-1","slug":"/module-1/chapter-1-2","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1/chapter-1-2","draft":false,"unlisted":false,"editUrl":"https://github.com/billy-pk/physical-ai-humanoid-robotics-book/tree/main/frontend/docs/module-1/chapter-1-2.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"1.2 Python Integration with rclpy"},"sidebar":"defaultSidebar","previous":{"title":"1.1 ROS 2 Architecture & Core Concepts","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1/chapter-1-1"},"next":{"title":"1.3 URDF for Humanoid Robots","permalink":"/physical-ai-humanoid-robotics-book/docs/module-1/chapter-1-3"}}');var i=s(4848),t=s(8453);const l={sidebar_position:3,title:"1.2 Python Integration with rclpy"},o="Chapter 1.2: Python Integration with rclpy",c={},a=[{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Part 1: rclpy Fundamentals",id:"part-1-rclpy-fundamentals",level:2},{value:"The rclpy Node Lifecycle",id:"the-rclpy-node-lifecycle",level:3},{value:"Message Types",id:"message-types",level:3},{value:"Part 2: Hands-On Tutorial",id:"part-2-hands-on-tutorial",level:2},{value:"Project 1: Simple Publisher Node",id:"project-1-simple-publisher-node",level:3},{value:"Project 2: Simple Subscriber Node",id:"project-2-simple-subscriber-node",level:3},{value:"Project 3: Service Server and Client",id:"project-3-service-server-and-client",level:3},{value:"Service Server (Battery Monitor)",id:"service-server-battery-monitor",level:4},{value:"Service Client (Mission Planner)",id:"service-client-mission-planner",level:4},{value:"Step 4: Debugging Common Issues",id:"step-4-debugging-common-issues",level:3},{value:"Issue 1: &quot;ModuleNotFoundError: No module named &#39;rclpy&#39;&quot;",id:"issue-1-modulenotfounderror-no-module-named-rclpy",level:4},{value:"Issue 2: Node runs but doesn&#39;t publish/subscribe",id:"issue-2-node-runs-but-doesnt-publishsubscribe",level:4},{value:"Issue 3: &quot;Message type &#39;X&#39; not found&quot;",id:"issue-3-message-type-x-not-found",level:4},{value:"Issue 4: Subscriber callback never called",id:"issue-4-subscriber-callback-never-called",level:4},{value:"Part 3: Advanced Topics (Optional)",id:"part-3-advanced-topics-optional",level:2},{value:"Multi-threaded Execution",id:"multi-threaded-execution",level:3},{value:"Logging Levels",id:"logging-levels",level:3},{value:"Integration with Capstone",id:"integration-with-capstone",level:2},{value:"Summary",id:"summary",level:2},{value:"Exercises",id:"exercises",level:2},{value:"Exercise 1: Velocity Command Publisher (Required)",id:"exercise-1-velocity-command-publisher-required",level:3},{value:"Exercise 2: Odometry Subscriber (Required)",id:"exercise-2-odometry-subscriber-required",level:3},{value:"Exercise 3: Two-Node Communication (Challenge)",id:"exercise-3-two-node-communication-challenge",level:3},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-12-python-integration-with-rclpy",children:"Chapter 1.2: Python Integration with rclpy"})}),"\n",(0,i.jsx)(n.p,{children:"Python is the primary language for rapid robotics development. The `rclpy` library provides a Pythonic interface to ROS 2, enabling you to build nodes, publish data, subscribe to topics, and create services\u2014all with clean, readable code."}),"\n",(0,i.jsx)(n.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement"})," publisher nodes that send sensor data to topics"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create"})," subscriber nodes that process incoming messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configure"})," timers for periodic control loops (e.g., 10 Hz, 50 Hz)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Build"})," service servers and clients for request/reply patterns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Debug"})," Python nodes using ROS 2 logging and introspection tools"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ROS 2 Humble installed"})," (Chapter 1.1)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Python 3.10+"})," (check with `python3 --version`)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Basic Python"}),": classes, methods, `",(0,i.jsx)(n.strong,{children:"init"}),"`, decorators"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Understanding of ROS 2 concepts"}),": nodes, topics, services (Chapter 1.1)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"part-1-rclpy-fundamentals",children:"Part 1: rclpy Fundamentals"}),"\n",(0,i.jsx)(n.h3,{id:"the-rclpy-node-lifecycle",children:"The rclpy Node Lifecycle"}),"\n",(0,i.jsx)(n.p,{children:"Every ROS 2 Python node follows this pattern:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MyNode(Node):\n    def __init__(self):\n        super().__init__('node_name')\n        # Initialize publishers, subscribers, timers, services\n    \ndef main(args=None):\n    rclpy.init(args=args)           # Initialize ROS 2 context\n    node = MyNode()                  # Create node instance\n    rclpy.spin(node)                 # Keep node alive and process callbacks\n    node.destroy_node()              # Cleanup\n    rclpy.shutdown()                 # Shutdown ROS 2 context\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key functions"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"`rclpy.init()`"}),": Initializes ROS 2 communication"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"`rclpy.spin()`"}),": Blocks and processes callbacks (subscriptions, timers, services)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"`node.destroy_node()`"}),": Cleans up resources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"`rclpy.shutdown()`"}),": Closes ROS 2 context"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"message-types",children:"Message Types"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 messages are strongly typed. Common message packages:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Package"}),(0,i.jsx)(n.th,{children:"Use Case"}),(0,i.jsx)(n.th,{children:"Example Types"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"std_msgs"})}),(0,i.jsx)(n.td,{children:"Simple data"}),(0,i.jsx)(n.td,{children:"`String`, `Int32`, `Float64`, `Bool`"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"sensor_msgs"})}),(0,i.jsx)(n.td,{children:"Sensor data"}),(0,i.jsx)(n.td,{children:"`Image`, `LaserScan`, `Imu`, `JointState`"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"geometry_msgs"})}),(0,i.jsx)(n.td,{children:"Positions/velocities"}),(0,i.jsx)(n.td,{children:"`Pose`, `Twist`, `PoseStamped`"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"nav_msgs"})}),(0,i.jsx)(n.td,{children:"Navigation"}),(0,i.jsx)(n.td,{children:"`Odometry`, `Path`"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Import syntax"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from std_msgs.msg import String, Int32\nfrom sensor_msgs.msg import JointState\nfrom geometry_msgs.msg import Twist\n"})}),"\n",(0,i.jsx)(n.h2,{id:"part-2-hands-on-tutorial",children:"Part 2: Hands-On Tutorial"}),"\n",(0,i.jsx)(n.h3,{id:"project-1-simple-publisher-node",children:"Project 1: Simple Publisher Node"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),": Create a node that publishes joint angle commands at 10 Hz."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": `simple_publisher.py`"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nSimple Publisher Node\nPublishes joint angle commands to /joint_commands topic\nROS 2 Humble | Python 3.10+\n"""\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64\nimport math\n\nclass JointCommandPublisher(Node):\n    """\n    Publishes sinusoidal joint commands for demonstration.\n    Topic: /joint_commands\n    Type: std_msgs/msg/Float64\n    Rate: 10 Hz\n    """\n    def __init__(self):\n        super().__init__(\'joint_command_publisher\')\n        \n        # Create publisher\n        self.publisher_ = self.create_publisher(\n            Float64,                    # Message type\n            \'/joint_commands\',          # Topic name\n            10                          # Queue size (buffer last 10 messages)\n        )\n        \n        # Create timer that calls timer_callback every 0.1 seconds (10 Hz)\n        self.timer = self.create_timer(0.1, self.timer_callback)\n        \n        # Counter for generating sinusoidal motion\n        self.counter = 0\n        \n        self.get_logger().info(\'Joint Command Publisher started\')\n    \n    def timer_callback(self):\n        """\n        Called every 0.1 seconds (10 Hz).\n        Publishes sinusoidal joint angle.\n        """\n        msg = Float64()\n        \n        # Generate sinusoidal motion: angle = sin(counter * 0.1)\n        # Range: -1 to 1 radians\n        msg.data = math.sin(self.counter * 0.1)\n        \n        # Publish message\n        self.publisher_.publish(msg)\n        \n        # Log every 10th message (once per second)\n        if self.counter % 10 == 0:\n            self.get_logger().info(f\'Publishing joint command: {msg.data:.3f} rad\')\n        \n        self.counter += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointCommandPublisher()\n    \n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    \n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lines 21 to 26"}),": Create publisher with topic name, message type, and queue size"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lines 28 to 29"}),": Timer triggers `timer_callback()` every 0.1 seconds"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lines 40 to 42"}),": Generate sinusoidal joint motion"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lines 44 to 45"}),": Publish message to topic"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Queue size"}),": If subscribers are slow, keep last 10 messages in buffer"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Run the node"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Make executable\nchmod +x simple_publisher.py\n\n# Run directly (for testing)\npython3 simple_publisher.py\n\n# Or use ros2 run (after packaging in Chapter 1.4)\n# ros2 run my_package simple_publisher\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verify it's working"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 2: Echo the topic\nros2 topic echo /joint_commands\n\n# Terminal 3: Check publish rate\nros2 topic hz /joint_commands\n"})}),"\n",(0,i.jsx)(n.p,{children:"Expected output from `ros2 topic hz`:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"average rate: 10.002\n        min: 0.099s max: 0.101s std dev: 0.00050s window: 100\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"project-2-simple-subscriber-node",children:"Project 2: Simple Subscriber Node"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),": Create a node that subscribes to joint commands and logs them."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": `simple_subscriber.py`"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nSimple Subscriber Node\nSubscribes to joint commands and processes them\nROS 2 Humble | Python 3.10+\n"""\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64\n\nclass JointCommandSubscriber(Node):\n    """\n    Subscribes to /joint_commands and logs received values.\n    Topic: /joint_commands\n    Type: std_msgs/msg/Float64\n    """\n    def __init__(self):\n        super().__init__(\'joint_command_subscriber\')\n        \n        # Create subscription\n        self.subscription = self.create_subscription(\n            Float64,                        # Message type\n            \'/joint_commands\',              # Topic name\n            self.listener_callback,         # Callback function\n            10                              # Queue size\n        )\n        \n        self.get_logger().info(\'Joint Command Subscriber started\')\n    \n    def listener_callback(self, msg):\n        """\n        Called whenever a message arrives on /joint_commands.\n        \n        Args:\n            msg (Float64): Received joint angle in radians\n        """\n        # Convert radians to degrees for display\n        angle_degrees = msg.data * (180.0 / 3.14159)\n        \n        self.get_logger().info(\n            f\'Received joint command: {msg.data:.3f} rad ({angle_degrees:.1f}\xb0)\'\n        )\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointCommandSubscriber()\n    \n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    \n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lines 20 to 25"}),": Create subscription with topic, message type, callback, and queue size"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lines 29 to 40"}),": Callback triggered automatically when messages arrive"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Line 37"}),": Convert radians to degrees for human-readable output"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Callback execution"}),": Runs in background while `rclpy.spin()` processes events"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Run both nodes together"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Publisher\npython3 simple_publisher.py\n\n# Terminal 2: Subscriber\npython3 simple_subscriber.py\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected output"})," (subscriber terminal):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[INFO] [1698765432.123] [joint_command_subscriber]: Joint Command Subscriber started\n[INFO] [1698765432.224] [joint_command_subscriber]: Received joint command: 0.995 rad (57.0\xb0)\n[INFO] [1698765432.324] [joint_command_subscriber]: Received joint command: 0.985 rad (56.4\xb0)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"project-3-service-server-and-client",children:"Project 3: Service Server and Client"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),": Create a service that calculates battery runtime based on current draw."]}),"\n",(0,i.jsx)(n.h4,{id:"service-server-battery-monitor",children:"Service Server (Battery Monitor)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": `battery_service_server.py`"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nBattery Service Server\nProvides battery runtime estimation service\nROS 2 Humble | Python 3.10+\n"""\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts  # We\'ll use this as template\nfrom std_srvs.srv import Trigger\n\n# For real robot, create custom service type:\n# BatteryQuery.srv:\n#   float64 current_draw  # Amps\n#   ---\n#   float64 runtime       # Hours\n#   string status\n\nclass BatteryMonitor(Node):\n    """\n    Service that estimates battery runtime.\n    Service: /battery/estimate_runtime\n    Type: Trigger (simplified for demo)\n    """\n    def __init__(self):\n        super().__init__(\'battery_monitor\')\n        \n        # Create service\n        self.srv = self.create_service(\n            Trigger,                              # Service type\n            \'/battery/get_status\',                # Service name\n            self.battery_status_callback          # Callback function\n        )\n        \n        # Simulate battery state\n        self.battery_percent = 85.0  # 85% charged\n        \n        self.get_logger().info(\'Battery Monitor Service ready\')\n    \n    def battery_status_callback(self, request, response):\n        """\n        Called when a client requests battery status.\n        \n        Args:\n            request (Trigger.Request): Empty request\n            response (Trigger.Response): Contains success (bool) and message (string)\n        \n        Returns:\n            Trigger.Response: Battery status message\n        """\n        # Simulate battery drain\n        self.battery_percent -= 0.5\n        if self.battery_percent < 0:\n            self.battery_percent = 100.0  # Reset for demo\n        \n        # Prepare response\n        response.success = True\n        response.message = f\'Battery: {self.battery_percent:.1f}% remaining\'\n        \n        self.get_logger().info(f\'Service called. {response.message}\')\n        \n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = BatteryMonitor()\n    \n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    \n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.h4,{id:"service-client-mission-planner",children:"Service Client (Mission Planner)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": `battery_service_client.py`"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nBattery Service Client\nCalls battery service to check status\nROS 2 Humble | Python 3.10+\n\"\"\"\nimport rclpy\nfrom rclpy.node import Node\nfrom std_srvs.srv import Trigger\n\nclass MissionPlanner(Node):\n    \"\"\"\n    Client that queries battery status before starting missions.\n    \"\"\"\n    def __init__(self):\n        super().__init__('mission_planner')\n        \n        # Create client\n        self.client = self.create_client(Trigger, '/battery/get_status')\n        \n        # Wait for service to become available\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Waiting for battery service...')\n        \n        self.get_logger().info('Mission Planner ready')\n    \n    def check_battery(self):\n        \"\"\"\n        Calls the battery service and returns the response.\n        \n        Returns:\n            Trigger.Response: Battery status\n        \"\"\"\n        request = Trigger.Request()  # Empty request for Trigger service\n        \n        # Call service (blocks until response)\n        future = self.client.call_async(request)\n        rclpy.spin_until_future_complete(self, future)\n        \n        if future.result() is not None:\n            response = future.result()\n            self.get_logger().info(f'Battery status: {response.message}')\n            return response\n        else:\n            self.get_logger().error('Service call failed')\n            return None\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MissionPlanner()\n    \n    # Check battery 5 times\n    for i in range(5):\n        node.get_logger().info(f'--- Mission {i+1} ---')\n        response = node.check_battery()\n        \n        if response and response.success:\n            battery_percent = float(response.message.split(':')[1].split('%')[0])\n            \n            if battery_percent > 20.0:\n                node.get_logger().info('\u2713 Battery OK, starting mission')\n            else:\n                node.get_logger().warn('\u26a0 Low battery, aborting mission')\n        \n        # Wait 1 second between checks\n        import time\n        time.sleep(1)\n    \n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Run service and client"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Start service server\npython3 battery_service_server.py\n\n# Terminal 2: Run client\npython3 battery_service_client.py\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected Output"})," (client terminal):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[INFO] [mission_planner]: Mission Planner ready\n[INFO] [mission_planner]: --- Mission 1 ---\n[INFO] [mission_planner]: Battery status: Battery: 84.5% remaining\n[INFO] [mission_planner]: \u2713 Battery OK, starting mission\n[INFO] [mission_planner]: --- Mission 2 ---\n[INFO] [mission_planner]: Battery status: Battery: 84.0% remaining\n[INFO] [mission_planner]: \u2713 Battery OK, starting mission\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"step-4-debugging-common-issues",children:"Step 4: Debugging Common Issues"}),"\n",(0,i.jsx)(n.h4,{id:"issue-1-modulenotfounderror-no-module-named-rclpy",children:"Issue 1: \"ModuleNotFoundError: No module named 'rclpy'\""}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause"}),": ROS 2 environment not sourced"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"source /opt/ros/humble/setup.bash\n# Or add to ~/.bashrc\n"})}),"\n",(0,i.jsx)(n.h4,{id:"issue-2-node-runs-but-doesnt-publishsubscribe",children:"Issue 2: Node runs but doesn't publish/subscribe"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause"}),": Topic name mismatch (typo in topic name)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check active topics\nros2 topic list\n\n# Verify topic name matches exactly\nros2 topic info /joint_commands\n"})}),"\n",(0,i.jsx)(n.h4,{id:"issue-3-message-type-x-not-found",children:"Issue 3: \"Message type 'X' not found\""}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause"}),": Missing ROS 2 message package"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Install common message packages\nsudo apt install ros-humble-std-msgs ros-humble-sensor-msgs ros-humble-geometry-msgs\n"})}),"\n",(0,i.jsx)(n.h4,{id:"issue-4-subscriber-callback-never-called",children:"Issue 4: Subscriber callback never called"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause"}),": QoS profile mismatch between publisher and subscriber"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Use compatible QoS settings (more details in Chapter 1.5)\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy\n\nqos = QoSProfile(depth=10, reliability=ReliabilityPolicy.RELIABLE)\nself.publisher_ = self.create_publisher(Float64, '/topic', qos)\nself.subscription = self.create_subscription(Float64, '/topic', callback, qos)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"part-3-advanced-topics-optional",children:"Part 3: Advanced Topics (Optional)"}),"\n",(0,i.jsx)(n.h3,{id:"multi-threaded-execution",children:"Multi-threaded Execution"}),"\n",(0,i.jsx)(n.p,{children:"For complex nodes with multiple callbacks, use executors:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from rclpy.executors import MultiThreadedExecutor\n\nexecutor = MultiThreadedExecutor(num_threads=4)\nexecutor.add_node(node1)\nexecutor.add_node(node2)\n\ntry:\n    executor.spin()\nfinally:\n    executor.shutdown()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use case"}),": Process camera images in one thread while controlling motors in another."]}),"\n",(0,i.jsx)(n.h3,{id:"logging-levels",children:"Logging Levels"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 supports 5 logging levels:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"self.get_logger().debug('Detailed diagnostic info')\nself.get_logger().info('Normal operation')\nself.get_logger().warn('Warning, degraded performance')\nself.get_logger().error('Error occurred, function failed')\nself.get_logger().fatal('Critical error, node shutting down')\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Set logging level"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run my_package my_node --ros-args --log-level DEBUG\n"})}),"\n",(0,i.jsx)(n.h2,{id:"integration-with-capstone",children:"Integration with Capstone"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How this chapter contributes"})," to the Week 13 autonomous humanoid:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Voice input node"}),": Subscriber to `/audio` topic, publishes transcribed text"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"self.subscription = self.create_subscription(Audio, '/audio', self.process_audio, 10)\nself.text_pub = self.create_publisher(String, '/voice_command', 10)\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"LLM planning node"}),": Subscribes to `/voice_command`, publishes navigation goals"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"self.create_subscription(String, '/voice_command', self.plan_task, 10)\nself.goal_pub = self.create_publisher(PoseStamped, '/nav2/goal', 10)\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Service for object detection"}),': "Is the red ball visible?"']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"self.create_service(Trigger, '/vision/detect_object', self.detect_callback)\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Understanding publishers, subscribers, and services is essential for orchestrating the capstone's multi-node architecture."}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"You learned:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u2705 Created ",(0,i.jsx)(n.strong,{children:"publisher nodes"})," that send messages to topics at fixed rates"]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 Implemented ",(0,i.jsx)(n.strong,{children:"subscriber nodes"})," with callbacks to process incoming data"]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 Built ",(0,i.jsx)(n.strong,{children:"service servers"})," and ",(0,i.jsx)(n.strong,{children:"clients"})," for request/reply patterns"]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 Used ",(0,i.jsx)(n.strong,{children:"timers"})," for periodic control loops (10 Hz, 50 Hz)"]}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Debugged common `rclpy` issues with logging and introspection tools"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Next steps"}),": In Chapter 1.3, you'll model humanoid robots using URDF, the standard format for robot descriptions."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"exercises",children:"Exercises"}),"\n",(0,i.jsx)(n.h3,{id:"exercise-1-velocity-command-publisher-required",children:"Exercise 1: Velocity Command Publisher (Required)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Objective"}),": Create a node that publishes velocity commands for a mobile robot."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Tasks"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create `velocity_publisher.py`"}),"\n",(0,i.jsx)(n.li,{children:"Publish `geometry_msgs/msg/Twist` messages to `/cmd_vel`"}),"\n",(0,i.jsx)(n.li,{children:"Linear velocity: 0.5 m/s forward"}),"\n",(0,i.jsx)(n.li,{children:"Angular velocity: 0.1 rad/s (turning left)"}),"\n",(0,i.jsx)(n.li,{children:"Publish at 20 Hz"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Starter code"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from geometry_msgs.msg import Twist\n\nmsg = Twist()\nmsg.linear.x = 0.5   # m/s forward\nmsg.angular.z = 0.1  # rad/s counterclockwise\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Acceptance Criteria"}),":"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Node publishes at 20 Hz (verify with `ros2 topic hz /cmd_vel`)"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Twist message has correct linear and angular values"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Code includes logging statements"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Estimated Time"}),": 30 minutes"]}),"\n",(0,i.jsx)(n.h3,{id:"exercise-2-odometry-subscriber-required",children:"Exercise 2: Odometry Subscriber (Required)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Objective"}),": Subscribe to odometry data and extract robot position."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Tasks"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create `odom_subscriber.py`"}),"\n",(0,i.jsx)(n.li,{children:"Subscribe to `/odom` topic (type: `nav_msgs/msg/Odometry`)"}),"\n",(0,i.jsx)(n.li,{children:"Extract robot's (x, y) position from `msg.pose.pose.position`"}),"\n",(0,i.jsx)(n.li,{children:"Log position every 1 second"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Install nav_msgs"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install ros-humble-nav-msgs\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Hint"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from nav_msgs.msg import Odometry\n\ndef callback(self, msg):\n    x = msg.pose.pose.position.x\n    y = msg.pose.pose.position.y\n    self.get_logger().info(f'Position: x={x:.2f}, y={y:.2f}')\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Acceptance Criteria"}),":"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Successfully subscribes to `/odom`"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Logs (x, y) position"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","No errors when no publisher exists (node should wait gracefully)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Estimated Time"}),": 30 minutes"]}),"\n",(0,i.jsx)(n.h3,{id:"exercise-3-two-node-communication-challenge",children:"Exercise 3: Two-Node Communication (Challenge)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Objective"}),": Create two nodes that communicate bidirectionally."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Tasks"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Node A"})," (`temperature_sensor.py`):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Publishes random temperature (20 to 30\xb0C) to `/temperature` at 5 Hz"}),"\n",(0,i.jsx)(n.li,{children:"Subscribes to `/fan_speed` and logs received values"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Node B"})," (`fan_controller.py`):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Subscribes to `/temperature`"}),"\n",(0,i.jsx)(n.li,{children:"If temperature > 25\xb0C, publish fan_speed = 100 to `/fan_speed`"}),"\n",(0,i.jsx)(n.li,{children:"If temperature \u2264 25\xb0C, publish fan_speed = 0"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Hints"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import random\ntemp = random.uniform(20.0, 30.0)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Acceptance Criteria"}),":"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Both nodes run simultaneously"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Fan speed changes based on temperature"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Visualize with `rqt_graph` showing bidirectional communication"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Estimated Time"}),": 60 minutes"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.ros2.org/latest/api/rclpy/",children:"rclpy API Documentation"})," - Complete reference"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/ros2/examples/tree/humble/rclpy",children:"ROS 2 Python Examples"})," - Official example nodes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html",children:"Understanding Publishers and Subscribers"})," - Official tutorial"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Service-And-Client.html",children:"Services Tutorial"})," - Request/reply patterns"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Previous"}),": [\u2190 Chapter 1.1: ROS 2 Architecture](chapter-1 to 1.md) | ",(0,i.jsx)(n.strong,{children:"Next"}),": [Chapter 1.3: URDF for Humanoid Robots \u2192](chapter-1 to 3.md)"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var r=s(6540);const i={},t=r.createContext(i);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);